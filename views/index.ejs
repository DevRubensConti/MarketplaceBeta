<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <%- include('partials/navbar.ejs') %>
  <div class="mais-acessados-header">
    <h2>Itens mais acessados</h2>
  </div>
  <section class="mais-vistos">
  <div class="most-viewed-gallery">
    <% maisVistos.forEach(item => { %>
      <div class="card-produto-uniforme">
        <a href="/item/<%= item.id %>">
          <div class="imagem-container">
            <img src="<%= item.imagem_url.split(',')[0] %>" alt="Imagem do produto">
          </div>
          <div class="info-produto">
            <h3><%= item.nome %></h3>
            <p><strong>Preço:</strong> R$ <%= item.preco %></p>
            <p><strong>Shape:</strong> <%= item.shape || '—' %></p>
            <p><strong>Marca:</strong> <%= item.marca || '—' %></p>
            <p><strong>Condição:</strong> <%= item.condicao || '—' %></p>
            <p><strong>Acessos:</strong> <%= item.acessos || 0 %></p>
          </div>
        </a>
      </div>
    <% }) %>
  </div>
</section>
<div class="mais-acessados-header">
  <h2>Recomendações para você</h2>
</div>
<section class="home-recs">
  <!-- Reuso o mesmo grid/estilo dos mais vistos pra manter layout -->
  <div id="home-recs" class="most-viewed-gallery"></div>
</section>


  
  <div class="brands-gallery-title">
    <h2>Marcas</h2>
  </div>  
<div class="brands-filter-gallery-wrap">
  <div class="brands-carousel-row">
    <img src="/images/back.png" id="backBtn">
    <div class="brands-filter-gallery">
      <div>
        <a href="/produtos?marca=Fender"><img src="/images/brand_logos/brand_fender.png" alt="Fender"></a>
        <a href="/produtos?marca=Tagima"><img src="/images/brand_logos/brand_tagima.png" alt="Tagima"></a>
        <a href="/produtos?marca=Yamaha"><img src="/images/brand_logos/brand_yamaha.png" alt="Yamaha"></a>
        <a href="/produtos?marca=Ibanez"><img src="/images/brand_logos/brand_ibanez.png" alt="Ibanez"></a>
        <a href="/produtos?marca=Gibson"><img src="/images/brand_logos/brand_gibson.png" alt="Gibson"></a>
        <a href="/produtos?marca=Godin"><img src="/images/brand_logos/brand_godin.png" alt="Godin"></a>
        <a href="/produtos?marca=Guild"><img src="/images/brand_logos/brand_guild.png" alt="Guild"></a>
        <a href="/produtos?marca=Luna"><img src="/images/brand_logos/brand_luna.png" alt="Luna"></a>
        <a href="/produtos?marca=Gretsch"><img src="/images/brand_logos/brand_gretsch.png" alt="Gretsch"></a>
        <a href="/produtos?marca=Jackson"><img src="/images/brand_logos/brand_jackson.png" alt="Jackson"></a>
      </div>
    </div>
    <img src="/images/forward.png" id="forwardBtn">
  </div>
</div>

  <div class="stores-title">
    <h2>Lojas Favoritas:</h2>
  </div>
  <div class="stores-carousel-wrap">
    <div class="stores-carousel-row">
      <img src="/images/back.png" id="storesBackBtn">

      <div class="stores-carousel">
        <div>
          <% lojasTop.forEach(loja => { %>
            <a href="/loja/<%= loja.id %>" title="<%= loja.nomeFantasia %>">
              <img 
                src="<%= loja.icone_url || '/images/store_logos/store.png' %>" 
                alt="<%= loja.nomeFantasia %>" 
                class="banner-logo"
              >
            </a>
          <% }) %>
        </div>
      </div>

      <img src="/images/forward.png" id="storesForwardBtn">
    </div>

  </div>
  

  <script>
    const backBtn = document.getElementById("backBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const carousel = document.querySelector(".brands-filter-gallery");
  
    const scrollAmount = 400; // Adjust based on how much you want to scroll
  
    backBtn.addEventListener("click", () => {
      carousel.scrollBy({
        left: -scrollAmount,
        behavior: "smooth"
      });
    });
  
    forwardBtn.addEventListener("click", () => {
      carousel.scrollBy({
        left: scrollAmount,
        behavior: "smooth"
      });
    });
  </script>

<script>
  const storesbackBtn = document.getElementById("storesBackBtn");
  const storesforwardBtn = document.getElementById("storesForwardBtn");
  const storescarousel = document.querySelector(".stores-carousel");

  const storesScrollAmount = 400; // Adjust based on how much you want to scroll

  storesbackBtn.addEventListener("click", () => {
    storescarousel.scrollBy({
      left: -storesScrollAmount,
      behavior: "smooth"
    });
  });

  storesforwardBtn.addEventListener("click", () => {
    storescarousel.scrollBy({
      left: storesScrollAmount,
      behavior: "smooth"
    });
  });
</script>

<script>
(async () => {
  const sec   = document.querySelector('.home-recs');
  const grid  = document.getElementById('home-recs');
  const hdr   = document.querySelectorAll('.mais-acessados-header')[1]; // o segundo header (logo acima da seção)

  try {
    // Chama as recomendações da HOME (sem categoria = populares gerais)
    const res = await fetch('/api/recs/home');
    if (!res.ok) throw new Error('Falha ao carregar recomendações');
    const items = await res.json();

    if (!items || !items.length) {
      // Se vier vazio, remove a seção e o título pra não ficar “buraco”
      if (hdr) hdr.remove();
      if (sec) sec.remove();
      return;
    }

    // Renderiza usando o mesmo card da seção "mais acessados"
    grid.innerHTML = items.map(it => `
      <div class="card-produto-uniforme">
        <a href="/item/${it.id}">
          <div class="imagem-container">
            <img src="${(it.imagem_url || '').split(',')[0]}" alt="${it.nome}">
          </div>
          <div class="info-produto">
            <h3>${it.nome}</h3>
            <p><strong>Preço:</strong> R$ ${Number(it.preco).toFixed(2)}</p>
          </div>
        </a>
      </div>
    `).join('');
  } catch (err) {
    if (hdr) hdr.remove();
    if (sec) sec.remove();
    // opcional: console.error(err);
  }
})();
</script>

<%- include('partials/footer.ejs') %>



</body>
</html>